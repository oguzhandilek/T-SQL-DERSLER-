T-SQL DERSLERÄ°

ServerName alanÄ± iÃ§in "." localhost ve (local) yazmanÄ±z aynÄ± ÅŸeyler ifade eder.

localhostta yenii bir veritabanÄ± oluÅŸurmak iÃ§in CMD  satÄ±rÄ±na localdb create veritabaniAdi yazmanÄ±z yeterli.
 Daha sonra Managment Sever Name alanÄ±na (local)\veritabaniAdi yazarak baÄŸlanabilirisniz.
 
 
 
 
 
 --SELECT KOMUTU
select 3

select 3,5,7

select 'OÄŸuzhan'

print 'Dilek'

select * from Northwind.dbo.Personeller

select Adi, SoyAdi from Northwind.dbo.Personeller

--  ALIAS ATAMA
Select Adi AdÄ±, SoyAdi Soyisimler from Northwind.dbo.Personeller

-- BoÅŸluk Karakteri Olan Alias atama

select 1453 [Ä°stanbulun Fethi]


-- BoÅŸluk Karakteri Olan Tablo Sorgulama

select * from Northwind.dbo.[Satis Detaylari]

-- KolonlarÄ± BirleÅŸtirme

Select Adi+' '+ SoyAdi [Ä°sim  ve Soyisimler]  from Northwind.dbo.Personeller

-- FarklÄ± Tipte kolon BirleÅŸtirme

Select Adi+' '+ CONVERT(nvarchar,IseBaslamaTarihi) [Ä°ÅŸe BaÅŸlama Tarihleri] from Northwind.dbo.Personeller

Select Adi+' '+ CAST(IseBaslamaTarihi as nvarchar) [Ä°ÅŸe BaÅŸlangÄ±Ã§]  from Northwind.dbo.Personeller







USE Northwind

-- SELECT SORGULARÄ±NDA (WHERE) ÅARTÄ± YAZMAK

select * from dbo.Personeller

select * from dbo.Personeller where Sehir='London'

select * from dbo.Personeller where BagliCalistigiKisi<5

--And OperatÃ¶rÃ¼
-- Personeller tablosunda ÅŸehri london ve Ã¼lkesi UK olanlarÄ± listeleyelim.

select * from dbo.Personeller where Sehir='London' and Ulke='UK'

-- Or OperatÃ¶rÃ¼
-- Personeller tablosunda UnvanEki 'MC.' olan veya ÅŸehri Seattle olan tÃ¼m personelleri listeleyelim.

select * from dbo.Personeller where UnvanEki='Mr.' or  Sehir='Seattle'

--KarÅŸÄ±k Ã–rnekler
--AdÄ± Robert soyadÄ± King olan personelin tÃ¼m bilgilerini Ã§ek.

select * from dbo.Personeller where Adi='Robert' and SoyAdi='King'

-- PersonellD'si 5 olan personeli getir.
select * from dbo.Personeller where PersonelID=5

-- PersonellD'si 5 'ten bÃ¼yÃ¼k olan tÃ¼m personelleri getir.

select * from dbo.Personeller where PersonelID>=5

-- <> EÅŸit DeÄŸilse
-- = EÅŸitse
-- <= KÃ¼Ã§Ã¼k ve EÅŸitse
-- >= BÃ¼yÃ¼k ve EÅŸitse

-- Fonksiyon SonuÃ§larÄ±nÄ± ÅŸart Olarak Kullanmak
--- 1993 yÄ±lÄ±nda Ä°ÅŸe baÅŸlayanlarÄ± listele.

select * from dbo.Personeller where year(IseBaslamaTarihi)=1993

--- 1992 yÄ±lÄ±ndan sonra iÅŸe baÅŸlayanlarÄ± listele.

select * from dbo.Personeller where YEAR(IseBaslamaTarihi)>1992

-- DoÄŸum gÃ¼nÃ¼, ayÄ±n 29 olan personelleri listeleyelim.

select *from dbo.Personeller where Day(DogumTarihi)=29

--DoÄŸum yÄ±lÄ± 1950 ile 1965 yÄ±llarÄ± arasÄ±nda olan personelleri getirelim.

select * from dbo.Personeller where YEAR(DogumTarihi)>1950 and YEAR(DogumTarihi)<1965

--- YaÅŸadÄ±ÄŸÄ± ÅŸehrin Lcndon, Taccma ve Kirkland olan personellerin adÄ±nÄ± listeleyelim.

select Adi AdÄ± from dbo.Personeller where Sehir='London' or Sehir='Kirkland' or sehir='Tacoma'

---Between Komutu
select * from dbo.Personeller where YEAR(DogumTarihi)>1950 and YEAR(DogumTarihi)<1965

select * from dbo.Personeller where YEAR(DogumTarihi) between 1950 and 1965

select * from dbo.Personeller where PersonelID between 2 and 5

--In Komutu

 select Adi Ä°simler from dbo.Personeller where Sehir='London' or Sehir='Tacoma' or Sehir='Kirkland'

 select Adi isimler from dbo.Personeller where Sehir in('London','Tacoma','Kirklanda')

 select Adi AdÄ±, DogumTarihi [DoÄŸum Tarihi] from  dbo.Personeller where YEAR(DogumTarihi) in(1948,1963)
 
 
 
 
 
 
 
 Use Northwind
 -- LIKE SORGULARÄ±
-- % (Genel Ã–nemli DeÄŸil) OperatÃ¶rÃ¼

-- Ä°sminin baÅŸ harfi j olan personellerin adÄ±nÄ± ve soyadÄ±nÄ± yazdÄ±ralÄ±m.

select Adi AdÄ±, Soyadi SoyadÄ±  from dbo.Personeller where Adi like('j%')

-- Ä°sminin son harfi y olan personellerin adÄ±nÄ± ve soyadÄ±nÄ± yazdÄ±ralÄ±m.

select Adi Ä°sim, SoyAdi Soyisim from dbo.Personeller where Adi like '%y'

--- Ä°sminin son Ã¼Ã§ harfi ert olan personeli getirelim.

select Adi,Soyadi from dbo.Personeller where Adi like '%ert'

--- Ä°sminin ilk harfi r, son harfi t olan personeli getirelim.

select Adi,Soyadi from dbo.Personeller where Adi like 'r%t'

-- Gereksiz bir kullanÄ±m.
select Adi,Soyadi from dbo.Personeller where Adi like 'r%' and Adi like'%t'

--- Ä°sminde an geÃ§en personelin adÄ±nÄ± yazdÄ±ralÄ±m.

select Adi,Soyadi from dbo.Personeller where Adi like '%an%'

--- Ä°sminin baÅŸ harfi n olan ve Ä°Ã§erisinde an geÃ§en personeli getirelim.

select Adi,Soyadi from dbo.Personeller where Adi like 'n%an%'

-- Gereksiz bir kullanÄ±m.

select Adi,Soyadi from dbo.Personeller where Adi like 'n%' and Adi like'%an%'



-- _(Ã¶zel Onemli DeÄŸil) OperatÃ¶rÃ¼

-- Ä°sminin ilk harfi a, ikinci harfi fark etmez ve Ã¼Ã§Ã¼ncÃ¼ harfi d olan personeli getirelim.

select * from dbo.Personeller where Adi like 'a_d%'

-- Ä°sminin ilk harfi m, ikinci -Ã¼Ã§Ã¼ncÃ¼ - dÃ¶rdÃ¼ncÃ¼ fark etmez ve beÅŸinci harfi a olan personeli getirelim.

select * from dbo.Personeller where Adi like 'm___a%'

--[](ya da) OperatÃ¶rÃ¼

-- Ä°sminin ilk harfi n ya da m ya da r olan personelleri getirelim.

select * from dbo.Personeller where Adi like '[nmr]%'

-- Ä°sminin Ä°Ã§erisinde a ya da Ä° geÃ§en personelleri getirelim.

select * from dbo.Personeller where Adi like '%[ai]%'

-- [*-*] (Alfabetik ArasÄ±nda) OperatÃ¶rÃ¼

--- Ä°sminin baÅŸ harfi a Ä°le k arasÄ±nda alfabetik sÄ±raya gÃ¶re herhangi bir harf olan personellerin adÄ±nÄ± yazdÄ±ralÄ±m.

select * from dbo.Personeller where Adi like '[a-k]%'


-- [^*] (DeÄŸil) OperatÃ¶rÃ¼

--- Ä°sminin baÅŸ harfi a olmayan personelleri getirelim.

select *from dbo.Personeller where Adi like '[^a]%'

--- Ä°sminin baÅŸ harfi a ya da n olmayan personelleri getirelim.

select * from dbo.Personeller where Adi like '[^an]%'

-- Escape(KaÃ§Ä±ÅŸ) Karakterleri
-- Like sorgularÄ±nda kullandÄ±ÄŸÄ±mÄ±z %, _ , [] gibi Ã¶zel ifadeler eÄŸer ki verilerimiz iÃ§erisinde geÃ§iyorsa sorgulama esnasÄ±nda hata Ä°le karÅŸÄ±laÅŸabiliriz. BÃ¶yle durumlarda bu ifadelerin Ã¶zel ifade olmadÄ±ÄŸÄ±nÄ± escape karakterleri Ä°le belirleyebiliriz.
-- [] OperatÃ¶rÃ¼ Ä°le
-- Escape Komutu Ä°le

 select * from dbo.Personeller where Adi like '[_]%'

 select  Adi,Soyadi from dbo.Personeller where SoyAdi like 'n%%' escape 'n'
 
 select  Adi,Soyadi from dbo.Personeller where SoyAdi like 'n%%' escape 'n' --n kaÃ§Ä±ÅŸÄ±n baÅŸlangÄ±Ã§ alias gibi dÃ¼ÅŸÃ¼nebiliriz n den bir sonraki keyword deÄŸil demek 
 
 
 
 
 
 --AGGREGATE FONKSÄ°YONLAR

-- AVG : Ortlama AlÄ±r

select AVG(PersonelID) PersonelIdOrtalamasi from .dbo.Personeller

select AVG(BirimFiyati) [Birim FiyatÄ± Ort] from dbo.[Satis Detaylari]

--MAX: En BÃ¼yÃ¼k DeÄŸeri Bulur

select max(miktar) Miktar from dbo.[Satis Detaylari]

--MIN : En KÃ¼Ã§Ã¼k DeÄŸeri Bulur

select min(miktar) Miktar from dbo.[Satis Detaylari]

-- COUNT: Toplam kayÄ±t SaysÄ±nÄ± Verir

select COUNT(*) from dbo.Personeller

select count(Adi) [KayÄ±t SayÄ±sÄ±] from dbo.Personeller

-- SUM: ToplamÄ±nÄ± Verir

select sum(nakliyeUcreti) nakliyeUcreti from dbo.[Satislar]







--STRING FONKSÄ°YONLAR

-- LEFT :Soldan(baÅŸtan) belirtilen sayÄ±da karakteri getirir.
Select Adi, LEFT(Adi,2) from dbo.Personeller

-- RÄ°GHT : SaÄŸdan(sondan) belirtilen sayÄ±da karakteri getirir.

select Adi, RIGHT(Adi,2) from dbo.Personeller

-- UPPER :BÃ¼yÃ¼k harfe Ã§evirir.

select UPPER(Adi) from dbo.Personeller

select left(UPPER(Adi),3) from dbo.Personeller

-- UPPER :BÃ¼yÃ¼k harfe Ã§evirir.

select UPPER(SoyAdi) from dbo.Personeller

-- SUBSTRING : Belirtilen indexten itibaren belirtilen sayÄ±da karakter getir.

select soyadi, SUBSTRING(SoyAdi,2,3) from dbo.Personeller

-- LTRIM :Soldan boÅŸluklarÄ± keser.

select '       OÄŸuzhan'
select LTRIM('     OÄŸuzhan')

--- RTRIM : SaÄŸdaki boÅŸluklarÄ± keser.

select RTRIM('Zehra     ')

--- REVERSE :Tersine Ã§evirir.

select REVERSE(Adi) from dbo.Personeller

--- REPLACE :Belirtilen ifadeyi, belirtilen ifade ile deÄŸiÅŸtirir.

select REPLACE('Merhaba ben OÄŸuzhan','OÄŸuzhan','Zehra') 

--CHARINDEX :Belirtilen karakterin veri iÃ§inde sÄ±ra numarasÄ±nÄ± verir.

select MusteriAdi, CHARINDEX('r',MusteriAdi) from dbo.Musteriler

-- CHARINDEX ornek
--- MÃ¼ÅŸteriler tablosunun MusteriAdi kolonundan sadece adlarÄ±nÄ± Ã§ekelim.

select MusteriAdi, SUBSTRING(MusteriAdi,0,CHARINDEX(' ',MusteriAdi)) [Ä°lk AdÄ±] from dbo.Musteriler

--- MÃ¼ÅŸteriler- tablosunun Musterâ€¢iAdi kolonundan sadece soyadlarÄ±nÄ± Ã§ekelim.

select MusteriAdi
,SUBSTRING(MusteriAdi
,CHARINDEX(' ',MusteriAdi)
,LEN(MusteriAdi)-(charindex(' ',MusteriAdi)-1)) 
from dbo.Musteriler





-- SAYÄ±SAL DEÄER Ä°ÅLEMLERI

select 3 + 2
select 4-2
select 5*2 
select 10/2

--Pi sayÄ±sÄ±nÄ± verir.
select PI()

--- SIN : SinÃ¼s alÄ±r.
select SIN(90)

-- POWER :Ãœs alÄ±r.
select power(2,3)

-- ABS : Mutlak deÄŸer alÄ±r.
select abs(-12)

--RAND: 0 - 1 arasÄ±nda rastgele sayÄ± Ã¼retir.
Select RAND()

-- FLOOR :Yuvarlama yapar.
select FLOOR(rand()*100)



-- Tarih FonksiyonlarÄ±
--- GETDATE :Bu gÃ¼nÃ¼n tarihini verir.

select GETDATE()

-- DATEADD :Verilen tarihe verildiÄŸi kadar gÃ¼n, ay, yÄ±l ekler.

select DATEADD(day,999,getdate())

select DATEADD(month,99,getdate())

select DATEADD(year,9,'5.5.2009')

-- DATEDIFF : Ä°ki tarih arasÄ±nda gÃ¼nÃ¼, ayÄ± veya yÄ±lÄ± hesaplar.

select DATEDIFF(day,'01.01.2025',getdate())
select DATEDIFF(day,'06.29.2015',getdate())

select DATEDIFF(month,'08.14.2021',getdate())

select DATEDIFF(year,'02.02.2024',GETDATE())

--- DATEPART :Verilen tarihin haftanÄ±n, ayÄ±n yahut yÄ±lÄ±n kaÃ§Ä±ncÄ± gÃ¼nÃ¼ olduÄŸunu hesaplar.

select DATEPART(DW,GETDATE()) --DW: Weekday

select DATEPART(month,getdate())

select DATEPART(day,getdate())

select DATEPART(year,getdate())




Use Northwind

--Top Komutu

select TOP 5 * from Personeller


--Distinct Komutu

select Sehir from Personeller

select DISTINCT Sehir from Personeller


--Group By Komutu

--Formulize edecek olursak: Normal kolon yanÄ±nda Aggregate fonksiyon Ã§aÄŸrÄ±lÄ±yorsa normal kolon Group By ile gruplanÄ±r

select PersonelID, count(*) [YaptÄ±ÄŸÄ± SatÄ±ÅŸ] from Satislar  GROUP BY PersonelID

select KategoriID,count(*) from Urunler group by KategoriID

select KategoriID,TedarikciID, count(*) from Urunler group by KategoriID,TedarikciID  --Birden fazla kolonu gruplama Ã¶rneÄŸi

select * from Urunler

select * from Satislar

select PersonelID,SUM(NakliyeUcreti) [Toplam Nakilye Ucreti] from Satislar group by PersonelID

--- Group By iÅŸleminde Where ÅartÄ± Kullanma

select PersonelID, count(*) from Satislar where PersonelID>5 group by PersonelID

select * from Urunler

select UrunAdi, BirimFiyati, count(*) [50 TL ve Uzeri] from Urunler where BirimFiyati>=50 group by UrunAdi,BirimFiyati

---Group By Ä°ÅŸleminde Having Komutu Kullanarak ÅŸart oluÅŸturma
--Not: Where komutu ile arasÄ±ndaki fark: Having aggregate fonksiyon iÃ§in ÅŸart gerekirse yazÄ±lÄ±r ve groupby komutundan sonra gelir.

select PersonelID, count(*) [Toplam KayÄ±t] from Satislar where PersonelID>5 group by PersonelID having count(*)>70




-- TablolarÄ± Yan Yana BirleÅŸtitme

Select * from Personeller
select * from Satislar

select * from Personeller, Satislar

select p.PersonelID, s.MusteriID from Personeller p , Satislar s

select p.PersonelID,s.PersonelID, count(*) [Toplam KayÄ±t] from Personeller p,Satislar s where p.PersonelID=s.PersonelID group by p.PersonelID,s.PersonelID

--YukarÄ±daki birleÅŸtirme Ã¶rneÄŸi ilkel bir yapÄ±dadÄ±r. aÅŸaÄŸÄ±da Joinleri bu yapÄ±yÄ± baz alarak iÅŸleyip  avantajlarÄ± veya dezavantajlarÄ±nÄ± inceleyeceÄŸiz




--- Inner Join veya Join
--- Genel MantÄ±k
--- Select * from Tablo1 Inner Join Tab1o2 on Tablo1.IliskiliKolon=Tablo2.IliskiliKolon
--- Tablolara alias tanÄ±mlanabilir.
--- Select * from Tablo1 t1 Inner Join Tablo2 t2 on t1.IliskiliKolon=t2.IliskiilKolon
--- Ä°ki Tabloyu Ä°liÅŸkisel BirleÅŸtirme
USE Northwind

--- Hangi personel hangi satÄ±ÅŸlarÄ± yapmÄ±ÅŸtÄ±r.(Personeller,Satislar)

select * from Personeller
select * from Satislar

select p.Adi+' '+p.SoyAdi [AdÄ± SoyadÄ±], s.SevkAdi from Personeller p inner join Satislar s on p.PersonelID=s.PersonelID 

--Hangi Ã¼rÃ¼n hangi kategoride. (Urunler, Kategoriler)

select u.UrunAdi, k.KategoriAdi from Urunler u inner join Kategoriler k on u.UrunID=k.KategoriID


--Inner Join'de Where Komutunun KullanÄ±mÄ±

--Beverages kategorisindeki Ã¼rÃ¼nlerim. (Urunler, Kategoriler)

select * from Urunler u inner join Kategoriler k on u.UrunID=k.KategoriID where k.KategoriAdi='Beverages'

--Beverages kategorisindeki Ã¼rÃ¼nlerimin sayÄ±sÄ± kaÃ§tÄ±r. (Urunler, Kategoriler)

select count(u.UrunAdi) KayÄ±t from Urunler u inner join Kategoriler k on u.UrunID=k.KategoriID where k.KategoriAdi='Beverages'

--Seafood kategorisindeki Ã¼rÃ¼nlerin listesi (Urunler, Kategoriler)

select u.UrunAdi Urunler from Urunler u inner join Kategoriler k on u.UrunID=u.KategoriID where k.KategoriAdi='Seafood'

--Hangi satÄ±ÅŸÄ± hangi Ã§alÄ±ÅŸanÄ±m yapmÄ±ÅŸ? (Satislar, Personeller)

select p.Adi+' '+p.SoyAdi [AdÄ± SoyadÄ±], s.SevkAdi from Satislar s inner join Personeller p  on s.PersonelID=p.PersonelID 

--Faks numarasÄ± 'nullâ€ olmayan tedarikcilerden alÄ±nmÄ±ÅŸ Ã¼rÃ¼nler nelerdir? (Urunler,Tedarikciler)

select u.UrunAdi,t.Faks from Urunler u inner join Tedarikciler t on u.TedarikciID=t.TedarikciID where t.Faks<>'Null'

select u.UrunAdi,t.Faks from Urunler u inner join Tedarikciler t on u.TedarikciID=t.TedarikciID where t.Faks is not null




-- - Ä°kiden Fazla Tabloyu Ä°liÅŸkisel BirleÅŸtirme
--- 1997 yÄ±lÄ±ndan sonra Nancy nin satÄ±ÅŸ yaptÄ±ÄŸÄ± firmalarÄ±n isimleri: (1997 dahil)(MÃ¼ÅŸteriler, Satislar, Personeller)

select p.Adi, m.SirketAdi from Personeller p inner join Satislar s on p.PersonelID=s.PersonelID inner join Musteriler m on m.MusteriID=s.MusteriID where p.Adi='Nancy' and  Year(s.SatisTarihi)>=1997

-- Limited olan tedarikÃ§ilerden alÄ±nmÄ±ÅŸ seafood kategorisindeki Ã¼rÃ¼nlerimin toplam satÄ±ÅŸ tutarÄ±. (Urunler , Kategoriler, Tedarikciler)

select Sum(u.BirimFiyati * u.HedefStokDuzeyi) [Toplam SatÄ±ÅŸ TutarÄ±] from Kategoriler k inner join Urunler u on k.KategoriID=u.KategoriID inner join Tedarikciler t on t.TedarikciID=u.TedarikciID where k.KategoriAdi='Seafood' and t.SirketAdi Like '%Ltd.%'



-- - AynÄ± Tabloyu Ä°liÅŸkisel Olarak BirleÅŸtirme

-- Personellerimin baÄŸlÄ± olarak Ã§alÄ±ÅŸtÄ±ÄŸÄ± kiÅŸileri listele? (Personeller, Personeller)

select ast.Adi Ast, ust.Adi Ust from Personeller ust inner join Personeller ast on ust.PersonelID=ast.BagliCalistigiKisi


-- Inner Joinde Grup By

use Northwind
-- Hangi personelim(adl ve soyadÄ± Ä°le birlikte), toplam kaÃ§ adetlik satÄ±ÅŸ yapmÄ±ÅŸ. SatÄ±ÅŸ adedi 100 den fazla olanlar ve personelin adÄ±nÄ±n baÅŸ harfi M olan kayÄ±tlar gelsin. (Personeller, Satislar)

select p.Adi+' '+p.SoyAdi [AdÄ±SoyadÄ±], count(s.SatisID) from Personeller p inner join Satislar s on p.PersonelID=s.PersonelID  where p.Adi like 'M%' group by p.Adi+' '+p.SoyAdi having COUNT(s.SatisID)>100 

--- Seafood kategorisindeki Ã¼rÃ¼nlerin sayÄ±sÄ±? (Urunler, Kategoriler)

select k.KategoriAdi, count(*) KayitSayisi from Kategoriler k inner join Urunler u on k.KategoriID=u.KategoriID where k.KategoriAdi='Seafood' group by k.KategoriAdi

-- Hangi personelim toplam kaÃ§ adet satÄ±ÅŸ yapmÄ±ÅŸ? (Personeller, Sati51ar)

select p.Adi+' '+p.SoyAdi [AdÄ± SoyadÄ±], count(*) [SattÄ±ÄŸÄ± Urun Adeti] from Personeller p inner join Satislar s on p.PersonelID=s.PersonelID group by p.Adi+' '+p.SoyAdi

--- En Ã§ok satÄ±ÅŸ yapan personelim? (Personeller, Satislar)
select top 1 p.Adi, COUNT(*) from Personeller p inner join Satislar s on p.PersonelID=s.PersonelID group by p.Adi order by COUNT(*) desc

--- AdÄ±nda "aâ€ harfi olan personellerin satÄ±ÅŸ id si 10500 den bÃ¼yÃ¼k olan satÄ±ÅŸlarÄ±nÄ±n toplam tutarÄ±nÄ±(miktar*birimfiyat) ve bu satÄ±ÅŸlarÄ±n hangi tarihte gerÃ§ekleÅŸtiÄŸini listele. (Personeller, Satislar, [SatÄ°s Detaylari)

 select convert(nvarchar,day(s.SatisTarihi)) + '.' + convert(nvarchar,month(s.Satistarihi)) + '.' + convert(nvarchar,year(s.Satistarihi)) [SatÄ±ÅŸ Tarihi], SUM(d.Miktar*d.BirimFiyati) [toplam SatÄ±ÅŸ TutarÄ±] from Personeller p inner join Satislar s on p.PersonelID=s.PersonelID inner join [Satis Detaylari] d on s.SatisID=d.SatisID where p.Adi like '%a%' and s.SatisID>10500 group by s.SatisTarihi order by s.SatisTarihi asc




--Outer Join(Left,Right,Full) ile TablolarÄ± BirleÅŸtirme 

use OrnekVT
INSERT INTO Filmler (Filmid, FilmAdi) VALUES
(1, 'GORA'),
(2, 'Lord Of The Rings'),
(3, 'DÃ¼ÄŸÃ¼n Dernek'),
(4, 'Bir Zamanlar Anadolu''da'),
(5, 'Kurtlar Vadisi'),
(6, 'Recep Ä°vedik'),
(7, 'DÃ¼ÄŸÃ¼n Dernek'),
(8, 'Kahpe Bizans');

select * from Filmler

INSERT INTO Oyuncular (OyuncuId, Filmid, Adi, Soyadi) VALUES
(1, 1, 'Cem', 'YÄ±lmaz'),
(2, 2, 'Muiddin', 'Ä°mpatrino'),
(4, 2, 'Turgay', 'Arslaner'),
(5, 3, 'GÃ¶khan', 'AÅŸker'),
(6, 4, 'Mustafa', 'AÄŸaoÄŸlu'),
(7, 4, 'Mustafa', 'GÃ¼loÄŸlu'),
(8, 5, 'Mustafa', 'NuroÄŸlu'),
(9, 5, 'M ust4', 'BilmemneoÄŸlu');

select * from Oyuncular


-- Inner Jcin'de eÅŸleÅŸen kayÄ±tlar getiriliyordu. Outer Join 'de ise eÅŸleÅŸmeyen kayÄ±tlarda getirilmektedir.


-- Left Join
-- Join ifadesinin solundaki tablodan tÃ¼m kayÄ±tlarÄ± getirir. SaÄŸÄ±ndaki tablodan eÅŸleÅŸenleri yan yana eÅŸleÅŸmeyenleri null olarak getirir.

select * from Filmler f left outer join Oyuncular o on f.FilmId=o.FilmID
select * from Oyuncular o left outer join Filmler f on o.FilmID=f.FilmId

-- veya

select * from Oyuncular o left join Filmler f on o.FilmID=f.FilmId
select *from Filmler f left join Oyuncular o on f.FilmId=o.FilmID

--Not : outer keyword'Ã¼ eskiden kullanÄ±lÄ±yordu. GÃ¼ncel olarak kullanÄ±lmasÄ±na gerek yok dolayÄ±syla aÅŸaÄŸÄ±daki komutlarda outer keyword'Ã¼ yazÄ±lmayacak.

--- Right Join
-- Joinin saÄŸÄ±ndaki tablonun tamamÄ±nÄ± getirecek, solundakinden eÅŸleÅŸenleri aynÄ± satÄ±rda eÅŸleÅŸmeyenleri de null olarak getirecek.

select * from Oyuncular o right join Filmler f on o.FilmID=f.FilmId
select* from Filmler f right join  Oyuncular o on o.FilmID=f.FilmId


-- Full Join
--- Joinin iki tarafÄ±ndaki tablolardan eÅŸleÅŸen eÅŸleÅŸmeyen hepsini getirir.
select * from Oyuncular o full join Filmler f on o.FilmID=f.FilmId

select * from Filmler f full join Oyuncular o on o.FilmID=f.FilmId





--Cross Join 
-- Cross Join iki tablo arasÄ±nda kartezyen Ã§arpÄ±m saÄŸlar ve sonucu tablo olarqak dÃ¶ndÃ¼rÃ¼r.
--AÅŸaÄŸÄ±daki Ã¶rnekte iki farklÄ± tabloyu cross join ile birleÅŸtireceÄŸiz. DoÄŸru birleÅŸmenin saÄŸlamasÄ±nÄ± iki tablonun eleman saysÄ±nÄ±n Ã§arpÄ±mÄ± ile doÄŸrulancakatÄ±r. Ã–rnek: Personeller Count = 9 BÃ¶lge Count =4 9*4=36 adet sonuÃ§ dÃ¶ndÃ¼rmesi gerekiyor.
use Northwind
select count(*) from Personeller 
select count(*) from Bolge

select p.Adi,b.BolgeID from Personeller p cross join Bolge b

--Not:
--1) DiÄŸer Join komutlarÄ±nda olduÄŸu gibi ON keyword'Ã¼nÃ¼ kullanmayÄ±z. Ã‡Ã¼nkÃ¼ kartezyen Ã§arpÄ±m ile bÃ¼tÃ¼n eÅŸleÅŸmeleri yapÄ±yor.
--2) Where keyword2Ã¼ ile herhangi bir ÅŸartta baÄŸlanamaz.

--Ã–rnek :
--10 Ã¶ÄŸrenci adayÄ± var âœ…

--9 farklÄ± temin tipi var âœ…

--Her Ã¶ÄŸrenci adayÄ± her temin tipini seÃ§ebilir (tÃ¼m kombinasyonlar gerekir) âœ…

--Yani:

--Her Ã¶ÄŸrenci 9 temin tipinden birini seÃ§ebileceÄŸi gibi hepsiyle eÅŸleÅŸmesi de ihtimal dahilinde.
--SonuÃ§: 10 Ã— 9 = 90 satÄ±r




-----DML KOMUTLARINA GÄ°RÄ°Å----

--DML (Data Manipulation Language)
---- Select, insert, Update, Delete
--- Select...
--- insert ...
--- Update ...
--- Delete ...

USE Northwind

--Select 
Select * from Personeller


--Insert 
-- Insert [Tablo AdÄ±] (Kolonlar) Values(DeÄŸerler)

--Kolon adÄ± belirterek ekleme
insert  Personeller(Adi,SoyAdi) values('OÄŸuzhan','Dilek') --Kolon adlarÄ± ile gÃ¶ndereceÄŸiniz values'ler aynÄ± Ä±rada olamalÄ±dÄ±r.

--TÃ¼m Kolonlara veri ekleme

insert Personeller values('Dilek','Zehra','TatlÄ± Bebek','Immm','01.01.2024',GETDATE(),'Ankara','Erzurum','Ä°Ã§Anadolu','0600','Turkiye',null,null,null,null,null,null)


--- [Dikkat Edilmesi Gerekenler! ! ! ]
--- Into Komutu Ä°le YazÄ±labilir
insert into Personeller(SoyAdi,Adi) values('Dilek','SutlaÃ§')
--- Kolonun kabul ettiÄŸi veri tipi ve karakter uzunluÄŸunda kayÄ±t yapÄ±lmalÄ±dÄ±r.
--- Not NuII olan kolonlara boÅŸ bÄ±rakÄ±lamayacaklarÄ±ndan dolayÄ± mutlaka deÄŸer gÃ¶nderilmelidir.
insert Personeller(Unvan,UnvanEki) values ('Doktor','Prof.')

-- Otomatik artan(Ä°dentÄ°ty) kolonlara deÄŸer gÃ¶nderilmez.
-- Tablodaki seÃ§ilen yahut bÃ¼tÃ¼n kolonlara deÄŸer gÃ¶nderileceÄŸi belirtilip, gÃ¶nderilmezse hata verecektir.

insert Personeller(Adi,SoyAdi) values('Dilek')
insert Personeller values('Dilek')

---[Pratik KullanÄ±m]
insert Personeller(Adi,Soyadi) values ('Sulhettin','Kebap')
insert Personeller(Adi,Soyadi) values ('Murtaza','Yanbakan')
insert Personeller(Adi,Soyadi) values ('MugÄ±me','DÃ¼zayak')

insert Personeller(Adi,SoyAdi) values ('Sulhettin','Kebap'),
	('Murtaza','Yanbakan'),
	('MugÄ±me','DÃ¼zayak')
	
	
	
--- [insert Komutu Ä°le Select Sorgusu Sonucu Gelen Verileri FarklÄ± Tabloya Kaydetme]
select * from OrnekPersoneller
insert OrnekPersoneller select Adi,Soyadi from Personeller
-- Burada dikkat etmeniz gereken nokta; Select sorgusunda donen kolon sayÄ±sÄ± Ä°le insert Ä°ÅŸlemi yapÄ±lacak tablonun;
-- 1) kolon sayÄ±sÄ± birbirine eÅŸit olmasÄ± 
-- 2) tiplerinin aynÄ± olmasÄ±
-- 3) Kolon SÄ±rasÄ±nÄ±n aynÄ± olmasÄ± gerekmektedir.
-- 4) Kolon isimlerinin dahi aynÄ± olamsÄ± lazÄ±m


-- [Select Sorgusu Sonucu Gelen Verileri FarklÄ± Bir Tablo OluÅŸturarak Kaydetme]
 select Adi,Soyadi,Ulke into OrnekPersoneller2 from Personeller
 select * from OrnekPersoneller2
--- Bu yÃ¶ntemle primary key ve foreign keyler oluÅŸturulamazlar.



--- Update
--- Update [Tablo AdÄ±] Set [Kolon AdÄ±] = DeÄŸer

use Northwind

update OrnekPersoneller set Adi='ÃœlkÃ¼' where Adi='Zehra' --EÄŸer where ÅŸartÄ± konulmazsa bÃ¼tÃ¼n kolunun hepsini set edilen deÄŸer ile gÃ¼nceller
select * from OrnekPersoneller

--- [Update Sorgusunda Join YapÄ±larÄ±nÄ± Kullanarak Birden Fazla Tabloda GÃ¼ncelleme Yapmak]
select * from OrnekPersoneller
--Personeller tablsounda 12 ID'li personelin soyadÄ±nÄ±  OrnekPersoneller tablsonudaki AdÄ± kolnuyla gÃ¼ncelle
update OrnekPersoneller set Adi= p.SoyAdi from Personeller p inner join OrnekPersoneller o on p.PersonelID=o.PersonelId where p.PersonelID=12

--- [Update Sorgusunda Subquery Ä°le GÃ¼ncelleme Yapmak)

Update OrnekPersoneller set Soyadi=(Select Adi from Personeller where PersonelID=3) where OrnekPersoneller.Adi='Janet'

--- [Update Sorgusunda Top KeywordÃ¼ Ä°le GÃ¼ncelleme Yapmak]

update top (3) OrnekPersoneller set SoyAdi=null


--- Delete
--- Delete from [Tablo AdÄ± ]

--[Delete Sorgusuna Where Åartl Yazmak]


Delete From OrnekPersoneller where PersonelId<=3
select * from OrnekPersoneller
--- [Dikkat Edilmesi Gerekenler! ! ! ]
-- Delete sorgusuyla tablo iÃ§erisindeki tÃ¼m verileri silmeniz identity kolonunu sÄ±frlamayacaktÄ±r. Silme iÅŸleminden sonra Ä°lk eklenen veride kalÄ±ndÄ±ÄŸÄ± yerden id deÄŸeri verilecektir.
delete from OrnekPersoneller where Adi in ('Zehra')



-- Union | UnÄ°on All
--- Union Komutu
--- Birden fazla select sorgusu sonucunu tek seferde alt alta gÃ¶stermemizi saÄŸlar.

---AiaÅŸÄ±daki senaryoda Musteriler tablosundaki ad soyadlarÄ± alÄ±p SÄ±nÄ±fA , Personeller Tablosundaki  ad soyadlarÄ± alÄ±p SÄ±nÄ±fB TablolarÄ± oluÅŸturlacak ve bunlarÄ± Union ile birleÅŸtirip alt alat sÄ±ralama yapacaÄŸÄ±z. bu ÅŸeilde Okuladki tÃ¼m Ã¶ÄŸrenci listesi Ã§Ä±kmÄ±ÅŸ olacak

select SUBSTRING(MusteriAdi,0,CHARINDEX(' ',MusteriAdi)) [Adi],SUBSTRING(MusteriAdi,CHARINDEX(' ',MusteriAdi),LEN(MusteriAdi)-(charindex(' ',MusteriAdi)-1))[SoyAdi]  into SinifB from Musteriler

select PersonelID,SoyAdi,Adi into SinifA from Personeller


Select  Adi,SoyAdi from SinifA
Union
Select Adi,SoyAdi from SinifB

--- 2 'den fazla
Select  Adi,SoyAdi from SinifA
Union
Select Adi,SoyAdi from SinifB
Union
Select Adi,SoyAdi from Personeller

--Joinler yan yana, Union alt alta tablolarÄ± birleÅŸtirir. Joinlerde belirli(iliÅŸkisel) bir kolon Ã¼zerinden birleÅŸtirme yapÄ±lÄ±rken, Union 'da bÃ¶yle bir durum yoktur.

--- Dikkat etmemiz gereken koÅŸullar;
-- Union sorgusunun sonucunda oluÅŸan tablonun kolon isimleri, Ã¼stteki sorgunun kolon Ä°simlerinden oluÅŸturulur.
--- Ãœstteki sorgudan kaÃ§ kolon Ã§ekilmiÅŸse alttaki sorgudan da o kadar Ã§ekilmek zorundadÄ±r.
-- Ãœstteki sorgudan Ã§ekilen kolonlarÄ±n tipleriyle, alttaki sorgudan Ã§ekilen kolonlarÄ±n tipleri uyumlu olmalÄ±dÄ±r.
--- Union tekrarlÄ± kayÄ±tlarÄ± getirmez.
-- Union'da kullanÄ±lan tablolara kolon eklenebilir. Dikkat etmemiz gereken nokta, yukarÄ±daki kurallar Ã§erÃ§evesinde aÅŸaÄŸÄ±yada yukarÄ±yada aynÄ± sayÄ±da kolonlarÄ±n eklenmesi gerekmektedir.


Select  Adi,SoyAdi,'A SÄ±nÄ±fÄ±' from SinifA
Union
Select Adi,SoyAdi,'B SÄ±nÄ±fÄ±' from SinifB

-- Union ALL
--- Union tekrarlÄ± kayÄ±tlarÄ± getirmez. TekrarlÄ± kayÄ±tlarÄ± getirmek iÃ§in Union All Komutu kullanÄ±lmalÄ±dÄ±r.

Select  Adi,SoyAdi from SinifA
Union All
Select Adi,SoyAdi from SinifA




-- With Rollup | Wtith Cube

-- With Rollup Group By ile gruplanmÄ±ÅŸ veri kÃ¼mesinde ara toplam alÄ±nmasÄ±nÄ± saÄŸlar.

Select Sehir,Urun,Sum(SatisMiktari) from Satislar group by Sehir,Urun with rollup
 --Sadece ÅŸehir bazlÄ± toplamlar + genel toplam var.

 --- [Having ÅartÄ±yla Beraber With Rollup]
 Select Sehir,Urun,Sum(SatisMiktari) from Satislar group by Sehir,Urun with rollup having sum(SatisMiktari)>10
 
 
 --With Cube TÃ¼m gruplarÄ±n tÃ¼m olasÄ± kombinasyonlarÄ±nÄ±n toplamlarÄ±nÄ± verir.

 Select Sehir,Urun,Sum(SatisMiktari) from Satislar group by Sehir,Urun with cube
 --ğŸ‘‰ Hem ÅŸehir hem Ã¼rÃ¼n bazlÄ± toplamlar + genel toplam var.

  --- [Having ÅartÄ±yla Beraber With Cube]
 Select Sehir,Urun,Sum(SatisMiktari) from Satislar group by Sehir,Urun with cube having sum(SatisMiktari)>10



-- Case - When- Else â€” End
-- Personellerimizin isim ve soyisimlerinin yanÄ±nda; UnvanEki 'Mr'Ä°se  Erkek, 'Ms.' ve'Mrs.' ise KadÄ±n  yazsÄ±n.

select Adi,SoyAdi,
Case
When UnvanEki='Mrs.' or Unvaneki='Ms.' Then 'KadÄ±n'
When UnvanEki='Mr.' Then 'Erkek'
Else UnvanEki
End
from Personeller

--- EÄŸer Ã¼rÃ¼nÃ¼n birim fiyatÄ± 0-50 arasÄ± Ä°se 'Ã‡in MalÄ±',	50 -100 arasÄ± Ä°se 'Ucuz',	100-200 arasÄ± Ä°se 'Normal' ve 200' den fazla Ä°se 'PahalÄ±' yazsÄ±n.

select UrunAdi,
Case
When BirimFiyati>0 and BirimFiyati<50 Then 'Ã‡in MalÄ±'
When BirimFiyati between 50 and 100 Then 'Ucuz'
When BirimFiyati between 100 and 200 Then 'Normal'
When BirimFiyati>200 Then 'PahalÄ±'
Else 'Belirsiz'
End
from Urunler

--YukarÄ±daki Ã¶rnekte bir filtre yapmak istersek o zamanda SubQuery yÃ¶nremini kullanÄ±rdÄ±k Yani;

select * from (select UrunAdi,
Case
When BirimFiyati>0 and BirimFiyati<50 Then 'Ã‡in MalÄ±'
When BirimFiyati between 50 and 100 Then 'Ucuz'
When BirimFiyati between 100 and 200 Then 'Normal'
When BirimFiyati>200 Then 'PahalÄ±'
Else 'Belirsiz'
End as FiyatGrubu
from Urunler) as UrunEtiketli
where FiyatGrubu='Ã‡in MalÄ±'


--With Ties Komutu
-- Bu komut TOP komutu ile birlikte kullananÄ±labilir. amacÄ± Belli sayÄ±da bir sÄ±ralama yaparken Ã¶rneÄŸin  ilk 6 kaydÄ± getirmek istediÄŸimizde 6. kayÄ±ta eÅŸ deÄŸer bir veri varsa onlarÄ± getirmeyi saÄŸlar. Mesala bir yarÄ±ÅŸmada ilk 3 kiÅŸi belirleriz ancak 3. kiÅŸi ilede aynÄ± puanÄ± almÄ±ÅŸ yarÄ±ÅŸmacÄ±lar olabilir. Ä°ÅŸte bÃ¶yle bir istisna durumda with ties komuut bize yardÄ±mcÄ± olacaktÄ±r.

--With Ties komutu kullanÄ±yorsan sorgunun sonunda ORDER BY'da kullanmak zorundasÄ±n

Select * from [Satis Detaylari]

select top 6 with ties * from [Satis Detaylari] order by SatisID


--With Komutu

-- WITH komutu (CTE - Common Table Expression),
-- karmaÅŸÄ±k sorgularÄ± daha okunabilir hale getirmek iÃ§in kullanÄ±lÄ±r.
-- GeÃ§ici bir sonuÃ§ kÃ¼mesi oluÅŸturur ve bu kÃ¼me, sorgunun devamÄ±nda sanki bir tablo gibi davranÄ±r.
-- Tek bir kez tanÄ±mlanÄ±r ve birden fazla kez kullanÄ±labilir (sorgu iÃ§inde).
-- Alt sorgulara gÃ¶re daha temiz ve modÃ¼ler bir yapÄ± sunar.


With PersonelSatis(id,adi,soyadi,satisId)
as 
(
select p.PersonelID,p.Adi,p.SoyAdi,s.SatisID from Personeller p inner join Satislar s on p.PersonelID=s.PersonelID
)

--select * from PersonelSatis

select * from PersonelSatis ps inner join [Satis Detaylari] sd on ps.satisId=sd.SatisID